<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <title>ë¦¬ë“¬ ê²Œì„ - ë²„ìŠ¤í‚¹ì´ ë©€ì§€ì•Šì•˜ë‹¤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
            background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #4facfe);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            overflow: hidden;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 20px;
            box-shadow: 
                0 20px 60px rgba(0,0,0,0.3),
                0 0 0 1px rgba(255,255,255,0.5) inset;
            max-width: 600px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            font-size: 28px;
            font-weight: bold;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .nav {
            text-align: center;
            margin-bottom: 15px;
        }

        .nav a {
            color: #667eea;
            text-decoration: none;
            font-size: 14px;
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s;
            display: inline-block;
            margin: 0 5px;
        }

        .nav a:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .score-value {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-area {
            position: relative;
            height: 400px;
            background: linear-gradient(180deg, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.3) 100%);
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .lane {
            position: absolute;
            width: 25%;
            height: 100%;
            border-right: 2px solid rgba(255,255,255,0.2);
        }

        .lane:last-child {
            border-right: none;
        }

        .target-line {
            position: absolute;
            bottom: 80px;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.8);
        }

        .note {
            position: absolute;
            width: 22%;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            animation: fall linear;
        }

        @keyframes fall {
            from { top: -60px; }
            to { top: 100%; }
        }

        .hit-zone {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-around;
            padding: 0 10px;
        }

        .hit-button {
            width: 22%;
            height: 60px;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
            border: 2px solid white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            cursor: pointer;
            transition: all 0.1s;
            user-select: none;
        }

        .hit-button:active, .hit-button.pressed {
            background: linear-gradient(135deg, #667eea, #764ba2);
            transform: scale(0.95);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.8);
        }

        .feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
            font-weight: bold;
            color: white;
            text-shadow: 0 4px 8px rgba(0,0,0,0.5);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .feedback.show {
            opacity: 1;
        }

        .feedback.perfect { color: #48bb78; }
        .feedback.good { color: #4299e1; }
        .feedback.miss { color: #f56565; }

        .controls {
            text-align: center;
            margin-bottom: 15px;
        }

        .start-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 
                0 4px 15px rgba(102, 126, 234, 0.4),
                0 0 0 1px rgba(255,255,255,0.2) inset;
            font-weight: 600;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 20px rgba(102, 126, 234, 0.6),
                0 0 0 1px rgba(255,255,255,0.2) inset;
        }

        .start-btn.playing {
            background: linear-gradient(135deg, #f56565, #e53e3e);
        }

        .difficulty {
            text-align: center;
            margin-bottom: 15px;
        }

        .difficulty-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .difficulty-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .diff-btn {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #333;
        }

        .diff-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .instructions {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 15px;
            border-radius: 12px;
            font-size: 13px;
            color: #666;
            text-align: center;
        }

        .combo {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        @media (max-width: 600px) {
            .game-area {
                height: 300px;
            }

            h1 {
                font-size: 24px;
            }

            .score-value {
                font-size: 20px;
            }

            .hit-button {
                font-size: 16px;
                height: 50px;
            }

            .target-line {
                bottom: 60px;
            }

            .container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ® ë¦¬ë“¬ ê²Œì„</h1>
            <p>íƒ€ì´ë°ì— ë§ì¶° ë°•ìë¥¼ ì¡ì•„ë³´ì„¸ìš”!</p>
        </div>

        <div class="nav">
            <a href="index.html">â† ìŒì • ì²´í¬</a>
            <a href="metronome.html">ë©”íŠ¸ë¡œë†ˆ</a>
        </div>

        <div class="score-board">
            <div class="score-item">
                <div class="score-label">ì ìˆ˜</div>
                <div class="score-value" id="score">0</div>
            </div>
            <div class="score-item">
                <div class="score-label">ì½¤ë³´</div>
                <div class="score-value" id="combo">0</div>
            </div>
            <div class="score-item">
                <div class="score-label">ì •í™•ë„</div>
                <div class="score-value" id="accuracy">100%</div>
            </div>
        </div>

        <div class="difficulty">
            <div class="difficulty-label">ë‚œì´ë„ ì„ íƒ</div>
            <div class="difficulty-buttons">
                <button class="diff-btn" data-speed="2000">ì‰¬ì›€</button>
                <button class="diff-btn active" data-speed="1500">ë³´í†µ</button>
                <button class="diff-btn" data-speed="1000">ì–´ë ¤ì›€</button>
            </div>
        </div>

        <div class="game-area" id="gameArea">
            <div class="lane" style="left: 0%;"></div>
            <div class="lane" style="left: 25%;"></div>
            <div class="lane" style="left: 50%;"></div>
            <div class="lane" style="left: 75%;"></div>
            <div class="target-line"></div>
            <div class="combo" id="comboDisplay" style="display: none;">COMBO x0</div>
            <div class="feedback" id="feedback"></div>
            <div class="hit-zone">
                <div class="hit-button" data-lane="0">D</div>
                <div class="hit-button" data-lane="1">F</div>
                <div class="hit-button" data-lane="2">J</div>
                <div class="hit-button" data-lane="3">K</div>
            </div>
        </div>

        <div class="controls">
            <button class="start-btn" id="startBtn">ğŸ® ì‹œì‘í•˜ê¸°</button>
        </div>

        <div class="instructions">
            ğŸ’¡ <strong>ì¡°ì‘ë²•:</strong> D, F, J, K í‚¤ ë˜ëŠ” ë²„íŠ¼ í´ë¦­<br>
            ğŸ¯ ëª©í‘œì„ ì— ë…¸íŠ¸ê°€ ë„ë‹¬í•  ë•Œ ì •í™•íˆ ëˆŒëŸ¬ì£¼ì„¸ìš”!
        </div>
    </div>

    <script>
        let isPlaying = false;
        let score = 0;
        let combo = 0;
        let totalNotes = 0;
        let hitNotes = 0;
        let notes = [];
        let gameInterval = null;
        let noteSpeed = 1500;
        let audioContext = null;

        const gameArea = document.getElementById('gameArea');
        const startBtn = document.getElementById('startBtn');
        const scoreDisplay = document.getElementById('score');
        const comboDisplay = document.getElementById('combo');
        const accuracyDisplay = document.getElementById('accuracy');
        const feedbackDisplay = document.getElementById('feedback');
        const comboTextDisplay = document.getElementById('comboDisplay');

        const keyMap = {
            'd': 0, 'D': 0,
            'f': 1, 'F': 1,
            'j': 2, 'J': 2,
            'k': 3, 'K': 3
        };

        function playSound(frequency, duration = 0.1) {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        function createNote() {
            const lane = Math.floor(Math.random() * 4);
            const note = document.createElement('div');
            note.className = 'note';
            note.style.left = `${lane * 25 + 1.5}%`;
            note.style.animationDuration = `${noteSpeed}ms`;
            note.dataset.lane = lane;
            
            gameArea.appendChild(note);
            notes.push({ element: note, lane: lane, hit: false });

            setTimeout(() => {
                if (!note.dataset.hit) {
                    miss();
                }
                note.remove();
                notes = notes.filter(n => n.element !== note);
            }, noteSpeed);
        }

        function hitNote(lane) {
            const targetLinePos = gameArea.offsetHeight - 80;
            const tolerance = 50;

            let closestNote = null;
            let closestDistance = Infinity;

            notes.forEach(noteData => {
                if (noteData.lane === lane && !noteData.hit) {
                    const notePos = noteData.element.offsetTop;
                    const distance = Math.abs(notePos - targetLinePos);
                    
                    if (distance < closestDistance && distance < tolerance) {
                        closestDistance = distance;
                        closestNote = noteData;
                    }
                }
            });

            if (closestNote) {
                closestNote.hit = true;
                closestNote.element.dataset.hit = 'true';
                closestNote.element.remove();
                
                if (closestDistance < 20) {
                    perfect();
                } else {
                    good();
                }
            }
        }

        function perfect() {
            score += 100;
            combo++;
            hitNotes++;
            totalNotes++;
            updateScore();
            showFeedback('PERFECT!', 'perfect');
            playSound(800, 0.1);
        }

        function good() {
            score += 50;
            combo++;
            hitNotes++;
            totalNotes++;
            updateScore();
            showFeedback('GOOD', 'good');
            playSound(600, 0.1);
        }

        function miss() {
            combo = 0;
            totalNotes++;
            updateScore();
            showFeedback('MISS', 'miss');
            playSound(200, 0.2);
        }

        function updateScore() {
            scoreDisplay.textContent = score;
            comboDisplay.textContent = combo;
            
            if (combo > 0) {
                comboTextDisplay.textContent = `COMBO x${combo}`;
                comboTextDisplay.style.display = 'block';
            } else {
                comboTextDisplay.style.display = 'none';
            }

            const accuracy = totalNotes > 0 ? Math.round((hitNotes / totalNotes) * 100) : 100;
            accuracyDisplay.textContent = `${accuracy}%`;
        }

        function showFeedback(text, type) {
            feedbackDisplay.textContent = text;
            feedbackDisplay.className = `feedback ${type} show`;
            setTimeout(() => {
                feedbackDisplay.classList.remove('show');
            }, 500);
        }

        function startGame() {
            if (isPlaying) {
                stopGame();
                return;
            }

            isPlaying = true;
            score = 0;
            combo = 0;
            totalNotes = 0;
            hitNotes = 0;
            notes = [];
            updateScore();

            startBtn.textContent = 'â¸ ì¤‘ì§€';
            startBtn.classList.add('playing');

            gameInterval = setInterval(createNote, 800);
        }

        function stopGame() {
            isPlaying = false;
            clearInterval(gameInterval);
            
            notes.forEach(noteData => {
                noteData.element.remove();
            });
            notes = [];

            startBtn.textContent = 'ğŸ® ì‹œì‘í•˜ê¸°';
            startBtn.classList.remove('playing');
        }

        startBtn.addEventListener('click', startGame);

        document.querySelectorAll('.hit-button').forEach(button => {
            button.addEventListener('click', () => {
                const lane = parseInt(button.dataset.lane);
                button.classList.add('pressed');
                setTimeout(() => button.classList.remove('pressed'), 100);
                hitNote(lane);
            });
        });

        document.addEventListener('keydown', (e) => {
            if (keyMap.hasOwnProperty(e.key)) {
                const lane = keyMap[e.key];
                const button = document.querySelector(`.hit-button[data-lane="${lane}"]`);
                button.classList.add('pressed');
                hitNote(lane);
            }
        });

        document.addEventListener('keyup', (e) => {
            if (keyMap.hasOwnProperty(e.key)) {
                const lane = keyMap[e.key];
                const button = document.querySelector(`.hit-button[data-lane="${lane}"]`);
                button.classList.remove('pressed');
            }
        });

        document.querySelectorAll('.diff-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (isPlaying) return;
                
                document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                noteSpeed = parseInt(btn.dataset.speed);
            });
        });
    </script>
</body>
</html>